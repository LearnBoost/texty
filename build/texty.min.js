-function(){a=function a(a){this.text=a,this.pos=0,this.color("#888"),this.softLeft=/([A-Z][a-z0-9]*|[a-z0-9]+|_+| +)$/,this.softRight=/^([A-Z][a-z0-9]*|[a-z0-9]+|_+| +)/,this.hardLeft=/(\w+| +)$/,this.hardRight=/^(\w+| +)/,this.show()},a.prototype.show=function(){this.visible=!0;return this},a.prototype.hide=function(){this.visible=!1;return this},a.prototype.color=function(a){if(!a)return this;this._color=a;return this},a.prototype.move=function(a){var b=this.text._text.length;this.pos+=a,this.pos<0?this.pos=0:this.pos>b&&(this.pos=b);return this},a.prototype.moveLeft=function(a){return this.move(-(a||1))},a.prototype.moveRight=function(a){return this.move(a||1)},a.prototype.moveUp=function(){var a=this.text._text.slice(0,this.pos).split("\n"),b=a.pop(),c=a.pop()||"",d=c.slice(b.length).length;return this.moveLeft(b.length+d+1)},a.prototype.moveDown=function(){var a=this.text._text.slice(this.pos).split("\n"),b=a.shift(),c=a.shift()||"",d=c.slice(b.length).length;return this.moveRight(b.length+d+1)},a.prototype.moveTo=function(a,b){2==arguments.length?this.moveTo(this.text.indexOf(a,b)):this.pos=a;return this},a.prototype.moveWithPattern=function(a,b){var c=this.text._text,d,e=1;-1==b?c=c.slice(0,this.pos):c=c.slice(this.pos);if(d=a.exec(c))e=d[1].length;this.move(-1==b?-e:e);return e},a.prototype.moveLeftSoft=function(){return this.moveWithPattern(this.softLeft,-1)},a.prototype.moveRightSoft=function(){return this.moveWithPattern(this.softRight,1)},a.prototype.moveLeftHard=function(){return this.moveWithPattern(this.hardLeft,-1)},a.prototype.moveRightHard=function(){return this.moveWithPattern(this.hardRight,1)}}(),-function(){function a(a){var b=[];for(var c=0,d=a.length;c<d;++c)b.push(a[c]);return b}b=function b(){this.callbacks={}},b.prototype.on=function(a,b){(this.callbacks[a]=this.callbacks[a]||[]).push(b);return this},b.prototype.emit=function(b){var c=a(arguments).slice(1),d=this.callbacks[b];if(d)for(var e=0,f=d.length;e<f;++e)d[e].apply(this,c);return this}}(),-function(){selectorStyle=function a(b,c){var d=a.cache=a.cache||{},e=b+":"+c;if(d[e])return d[e];var f=b.split(/ +/),g=f.length,h=root=document.createElement("div"),i,j;for(var k=0;k<g;++k)j=f[k],i=document.createElement("div"),h.appendChild(i),h=i,"#"==j[0]?i.setAttribute("id",j.substr(1)):"."==j[0]&&i.setAttribute("class",j.substr(1));document.body.appendChild(root);var l=getComputedStyle(i)[c];document.body.removeChild(root);return d[e]=l}}(),-function(){a=function a(a){this.caret=new Caret(this),this.hide().listStyle("none").text(a||"").size(20).font("Helvetica").color("#000").selectionBackground("#DFF3FC").lineHeight(this._size)},a.prototype.inheritCSS=function(){var a=selectorStyle;this.size(parseInt(a(".text","font-size"),10)).font(a(".text","font-family")).color(a(".text","color")).selectionBackground(a(".text .selection","background-color")),this.listStyle(a(".text .line","list-style-type")).lineHeight(parseInt(a(".text .line","line-height"),10)),this.caret.color(a(".text .caret","color"))},a.prototype.lineHeight=function(a){this._lineHeight=a;return this},a.prototype.toString=function(){return this.text()},a.prototype.listStyle=function(a){if(0==arguments.length)return this._listStyle;if(!a)return this;this._listStyle=a;return this},a.prototype.text=function(a){if(arguments.length){this._text=a;return this}return this._text},a.prototype.color=function(a){if(!a)return this;this._textColor=a;return this},a.prototype.selectionBackground=function(a){if(!a)return this;this._selectionBackgroundColor=a;return this},a.prototype.remove=function(a){return this.removeAt(a,this.caret.pos)},a.prototype.removeAt=function(a,b){this._text=this._text.substr(0,b-a)+this._text.substr(b);return this.caret.move(-a)},a.prototype.removeRange=function(a,b){this._text=this._text.substr(0,a)+this._text.substr(b);return this.deselect().caret.moveTo(a)},a.prototype.selection=function(){if(!!this.selected){var a=this.selected.from,b=this.selected.to;return{string:this._text.slice(a,b),from:a,to:b}}},a.prototype.removeSelection=function(){if(!this.selected)throw new Error("no selection is made");var a=this.selected.from,b=this.selected.to;return this.removeRange(a,b)},a.prototype.clear=function(){return this.text("")},a.prototype.insert=function(a){return this.insertAt(a,this.caret.pos)},a.prototype.insertAt=function(a,b){this._text=this._text.substr(0,b)+a+this._text.substr(b);return this.caret.move(a.length)},a.prototype.indexOf=function(a,b){var c=this.text(),d=this._width,e=this._lineHeight,f=e||this._size,g=c.split("\n"),h=g.length*f,i=d/c.length,j=g.length,a=a-this.x,b=b-this.y,k=10;if(a<-k||a>d+k)return 0;if(b<-k||b>h+k)return 0;b<f&&(b=f),b=Math.ceil(b/f),b>j&&(b=j);var l=g.slice(0,b-1).join("\n").length;b&&++l;var m=l+a/i|0;return m},a.prototype.select=function(a,b,c,d){var e=this.indexOf(a,b),f=this.indexOf(c,d);return this.selectRange(e,f).caret.moveTo(c,d).text},a.prototype.selectWordAt=function(a,b){var c=this.indexOf(a,b);this.caret.moveTo(c);var d=this.caret.moveLeftHard();this.selectLeft(d),this.caret.moveTo(c);var e=this.caret.moveRightHard();this.selectRight(e),this.caret.moveTo(c);return this},a.prototype.selectLeft=function(a){var b=this.caret.pos,a=a||1,c;(c=this.selection())?this.selectRange(c.from-a,c.to):this.selectRange(b,b+a);return this},a.prototype.selectRight=function(a){var b=this.caret.pos,a=a||1,c;(c=this.selection())?this.selectRange(c.from,c.to+a):this.selectRange(b-a,b);return this},a.prototype.selectAll=function(){return this.selectRange(0,this._text.length)},a.prototype.selectRange=function(a,b){var c=this._text.length,d;a>b&&(d=a,a=b,b=d),this.selected={from:a>0?a:0,to:b<c?b:c};return this},a.prototype.deselect=function(){this.selected=null;return this},a.prototype.moveTo=function(a,b){this.x=a,this.y=b;return this},a.prototype.hide=function(){this.visible=!1;return this},a.prototype.show=function(){this.visible=!0;return this},a.prototype.font=function(a){if(0==arguments.length)return this._families;if(!a)return this;this._families=a;return this},a.prototype.size=function(a){if(0==arguments.length)return this._size;if(!a)return this;this._size=a;return this},a.prototype.drawSelection=function(a,b,c,d,e){var f=this.selection(),g=f.from,h=f.to,i=e.slice(0,g).split("\n"),j=i.length,k=i[j-1],l=e.slice(g,h).split("\n"),m=l.length,n=d/2,o=b,p=c,q,r;a.fillStyle=this._selectionBackgroundColor,c+=(j-1)*d,q=a.measureText(l[0]).width,k=a.measureText(k).width,a.fillRect(b+k,c-n,q,d);for(var s=1,t=m-1;s<t;++s)c+=d,q=a.measureText(l[s]).width,a.fillRect(b,c-n,q,d);m<2||(c+=d,k=l[m-1],q=a.measureText(k).width,a.fillRect(b,c-n,q,d))},a.prototype.drawCaret=function(a,b,c,d,e){if(!!this.caret.visible){var f=e.substr(0,this.caret.pos).split("\n"),g=f.length,h=f[g-1],i=d/2,j=a.measureText(h).width+2,c=c+ --g*d;a.strokeStyle=this.caret._color,a.beginPath(),a.moveTo(b+j,c-i-2),a.lineTo(b+j,c+i+2),a.stroke()}},a.prototype.drawText=function(a,b,c,d,e){var f=e.split("\n"),g=b;a.fillStyle=this._textColor,a.textBaseline="middle",a.font=this._size+"px "+this._families;for(var h=0,i=f.length;h<i;++h)a.fillText(f[h],b,c),b=g,c+=d},a.prototype.drawLineDecoration=function(a,b,c,d,e,f){var g=e.split("\n").length,h=a.measureText("M").width;a.save(),a.font=this._size*.65+"px "+this._families,b-=h;for(var i=0;i<g;++i)a.fillText("function"==typeof f?f(i):f,b,c),c+=d;a.restore()},a.prototype.draw=function(a){if(!this.visible)return this;var b=this._text,c=this._lineHeight,d=c||this._size,e=this.x,f=this.y;this._width=a.measureText(b).width,this.selected&&this.drawSelection(a,e,f,d,b),this.drawCaret(a,e,f,d,b),this.drawText(a,e,f,d,b);var g;switch(this._listStyle){case"decimal":g=function(a){return++a+"."};break;case"square":g="■";break;case"circle":g="○";break;case"disc":g="●"}g&&this.drawLineDecoration(a,e,f,d,b,g);return this}}()