<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf8">
    <script src="build/texty.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script>
      o = $;

      o(function(){
        var canvas = o('canvas').get(0)
          , ctx = canvas.getContext('2d')
          , text = new Text
          , prev
          , start;

        o(canvas).mousedown(function(e){
          var now = new Date
            , x = e.offsetX
            , y = e.offsetY;

          // double-click
          if (prev && now - prev < 200) {
            // TODO: triple-click for select all
            text.selectWordAt(x, y).caret.hide();
          } else {
            start = e;
            if (text.selected) text.deselect().caret.show();
            if (text.visible) {
              text.caret.moveTo(x, y);
            } else {
              text.show().moveTo(x, y);
            }
          }
          prev = new Date;
        });

        o(document).mousemove(function(e){
          if (!start) return;
          text.select(start.offsetX, start.offsetY, e.offsetX, e.offsetY);
          text.caret.hide();
        });

        o(document).mouseup(function(e){
          start = null;
        });

        o(document).keydown(function(e){
          var selection, n = 1;
           text.caret.show();
           switch (e.keyCode) {
             // newline
             case 0x0d:
               text.insert('\n');
               break;
             // A
             case 0x41:
               if (e.metaKey) text.selectAll().caret.hide();
               break;
             // -
             case 0xbd:
               if (e.metaKey) {
                 e.preventDefault();
                 text.size(text.size() - 5);
               }
               break;
             // +
             case 0xbb:
               if (e.metaKey) {
                 e.preventDefault();
                 text.size(text.size() + 5);
               }
               break;
             // backspace
             case 0x08:
               if (text.selected) {
                 text.removeSelection();
               } else {
                 text.remove(1);
               }
               break;
             // left
             case 0x25:
               // ctrl for soft / hard jumps
               if (e.ctrlKey) n = text.caret.moveLeftSoft();
               else if (e.altKey) n = text.caret.moveLeftHard();
               else text.caret.moveLeft();
               // selection
               if (e.shiftKey) text.selectLeft(n).caret.hide();
               else text.deselect();
               break;
             // up
             case 0x26:
               text.deselect().caret.moveUp();
               break;
             // right
             case 0x27:
               // ctrl for soft / hard jumps
               if (e.ctrlKey) n = text.caret.moveRightSoft();
               else if (e.altKey) n = text.caret.moveRightHard();
               else text.caret.moveRight();
               // selection
               if (e.shiftKey) text.selectRight(n).caret.hide();
               else text.deselect();
               break;
             // down
             case 0x28:
               text.deselect().caret.moveDown();
               break;
             // delete
             case 0x2E:
               if (text.selected) {
                 text.removeSelection();
               } else {
                 text.removeAt(1, text.caret.pos + 1);
                 text.caret.moveRight().hide();
               }
               break;
           }
        });

        o(document).keypress(function(e){
          if (!text.visible) return;
          if (e.ctrlKey) return;
          if (text.selected) text.removeSelection();
          text.insert(String.fromCharCode(e.keyCode));
        });

        o('[name=css]').click(function(){
          text.inheritCSS();
        });

        var fps = 24;
        setInterval(function(){
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          text.draw(ctx);
        }, 1000 / fps);
      });
    </script>
    <style>
      * {
        -webkit-user-select: none;
      }
      body {
        font: 14px helvetica, arial, sans-serif;
        padding: 20px;
      }
      .text {
        font-size: 20px;
        color: #888;
      }
      .text .line {
        list-style: square;
      }
      .text .caret {
        color: red;
      }
      .text .selection {
        background: rgba(255,0,0,0.1);
      }
    </style>
  </head>
  <body>
    <p>Inherit CSS styling: <input type="checkbox" name="css" /></p>
    <canvas width="900" height="400" style="border: 1px solid #eee;">
    </canvas>
  </body>
</html>